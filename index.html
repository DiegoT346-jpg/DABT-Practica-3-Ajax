<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>PÃ¡gina mostrar lista de pacientes</title>
  <style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      padding: 8px;
    }
    #error-ajax {
      color: red;
      visibility: hidden;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1 class="titulo">Mostrar listado</h1>
    </div>
  </header>

  <main>
    <section class="container">
      <h2>Mis pacientes</h2>
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Peso (kg)</th>
            <th>Altura (m)</th>
            <th>Gordura Corporal (%)</th>
            <th>IMC</th>
          </tr>
        </thead>
        <tbody id="tabla-pacientes"></tbody>
      </table>
      <span id="error-ajax">Error al buscar los pacientes</span>
      <br><br>
      <button id="buscar-paciente" class="boton bto-principal">Buscar Pacientes</button>
    </section>
  </main>

  <script>
    function construirTd(dato, clase) {
      const td = document.createElement("td");
      td.classList.add(clase);
      td.textContent = dato;
      return td;
    }

    function construirTr(paciente) {
      const pacienteTr = document.createElement("tr");
      pacienteTr.classList.add("paciente");
      pacienteTr.appendChild(construirTd(paciente.nombre, "info-nombre"));
      pacienteTr.appendChild(construirTd(paciente.peso, "info-peso"));
      pacienteTr.appendChild(construirTd(paciente.altura, "info-altura"));
      pacienteTr.appendChild(construirTd(paciente.gordura, "info-gordura"));
      pacienteTr.appendChild(construirTd(paciente.imc, "info-imc"));
      return pacienteTr;
    }

    function adicionarPacienteEnLaTabla(paciente) {
      const tabla = document.querySelector("#tabla-pacientes");
      const pacienteTr = construirTr(paciente);
      tabla.appendChild(pacienteTr);
    }

    const errorAjax = document.querySelector("#error-ajax");
    const botonBuscar = document.querySelector("#buscar-paciente");

    botonBuscar.addEventListener("click", function () {
      const xhr = new XMLHttpRequest();
      xhr.open("GET", "https://raw.githubusercontent.com/DiegoT346-jpg/DABT-Practica-3-Ajax/refs/heads/main/DABT%20Pacientes.json");

      xhr.addEventListener("load", function () {
        if (xhr.status === 200) {
          const pacientes = JSON.parse(xhr.responseText);
          pacientes.forEach(adicionarPacienteEnLaTabla);
          errorAjax.style.visibility = "hidden";
        } else {
          errorAjax.style.visibility = "visible";
        }
      });

      xhr.addEventListener("error", function () {
        errorAjax.style.visibility = "visible";
      });

      xhr.send();
    });
  </script>
</body>
</html>